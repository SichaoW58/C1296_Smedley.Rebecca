---
title: "Association of Ki67 index and prognosis markers"
author: 
  - name: Sichao Wang
    email: wangsic1@msu.edu
    affiliations: 
      - name: Michigan State University, Center for Statistical Training and Consulting
date: "`r format(Sys.time(), '%Y-%m-%d, %H:%M:%S %Z')`"
format: 
  html: 
    toc: true 
    toc-depth: 4
    toc-location: left 
    number-sections: true
    number-depth: 4
    code-fold: false 
    code-tools: false 
    embed-resources: true 
    theme: default 
execute: 
  eval: true 
  echo: false #fenced
  output: true 
  message: false 
  warning: false 
  error: false 
  include: true 
---

# Project Overview:

* Title: Correlation of histologic features and location with Ki67 index in canine eyelid melanocytic tumors *



Project PI's:

-   Rebecca,Smedley (Faculty)


CSTAT Personnel:

-   Sichao Wang, Ph.D.,

## Original Description

We have a set of about 150 eyelid melanomas from dogs. Some are on the haired skin side and some are on the conjunctival side. We would like to evaluate these 2 groups together as well as separately.  We have prognostic parameters for each tumor that include: mitotic count, nuclear atypia, presence of ulceration, depth of invasion (beyond the dermis), tumor thickness, degree of pigmentation, and Ki67 index.  We would like to use Ki67 index as our gold standard to determine whether or not a tumor is malignant. If the Ki67 index is above a threshold value it will indicate malignancy, if it is below the threshold the tumor will be classified as benign.  The other parameters can be similarly classified as above or below a certain threshold or yes or no.  We would like to see how each of the other parameters correlate with the Ki67 index - eg. how well they can predict prognosis independently or along with other parameters. For some of the parameters (mitotic count and tumor thickness) we may also want to look at the actual value of those parameters (as opposed to just above or below their thresholds) and see how well those values correlate with the Ki67 index. We would also like to see if location (haired skin vs conjunctival) is correlated to Ki67 index for a subset of about 50 tumors that we know the location for.



## Primary Objective:


**Exame the association of a few prognosis marker with Gold standard Ki67 index** 



**References**




## Project Updates:





```{r}
#| label: load-packages
#| include: false

pacman::p_load(## file folder setup
               fs,   # creat folder dir_create()
               here, # easy to do cross reference in the project.
               ## Data step
               readr,
               readxl, # read_excel()
               tidyverse,
               janitor,
               ## IDA
               Hmisc,
               ## Model
               meta,
               metafor,
               dmetar, #for find.outliers()
               lme4,
               glmmTMB,
               broom,
               emmeans,
               ## result reporting
               ### graph
               ggplot2,
               ### table
               gt,
               gtsummary,
               knitr,        # for kable()
               sjPlot      # tab_model()
               )


set.seed(42004063)

```



```{r}
#| label: setup-folder
#| include: false

# create the default folder/subfolder

dir_create(here("Data"))  # store raw data, clean data. 
dir_create(here("Data/Source"))  
dir_create(here("Data/Clean")) 

dir_create(here("Documents"))  # all the docs
dir_create(here("Code"))       # r code
dir_create(here("E-mails"))    # correspondence

# Declare location of this script relative to the project root directory.
here::i_am(path = "Code/C1296_Smedley_Association of Ki67 index and prognosis markers.qmd")  #save the qmd under code first and run this line.

# dir_ls()    # briefly check
# dir_tree()  # Show the tree, not necessary, takes time.
# dir_tree("Data")

```


```{r}
Dat_Melanoma<- read_excel(here("Data/Source/Copy of Melanoma Project 7-28-23  For STATS final.xlsx"), 
                          sheet = "Eyelid",
    col_types = c("text", "text", "text", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "text", "numeric", 
        "numeric"), na = c("N/A","unknown"))
```



```{r}
#| label: import-data
#| include: false

## Use gender as an example first.

Dat_gender <- read_excel(here("Data/Raw/Barrett's esophagus metanalysis data sheets.xlsx"), 
    sheet = "Gender", skip = 2) %>% 
  clean_names() %>% 
  rename(study="x1",male_BE="m_2",female_BE="f_3",male_EAC="m_4",female_EAC="f_5",male_CTR="m_6",female_CTR="f_7") %>%
  mutate(year=str_extract(study, "\\d+"),author=str_extract(study, "[A-Za-z-]+"))



Dat_Melanoma<- read_excel(here("Data/Raw/Copy of Melanoma Project 7-28-23  For STATS final.xlsx"), 
                          sheet = "Eyelid",
    col_types = c("text", "text", "text", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "text", "numeric", 
        "numeric"), na = c("N/A","unknown"))


Melanoma_Project_For_STATS_final <- read_csv(here("Data/Raw/Melanoma Project For STATS final.csv"), 
    col_types = cols(`Case  Number` = col_character(), 
        `GOLD STANDARD    Ki67: >15%= 1, <15% = 0` = col_factor(levels = c("1", 
            "0")), `1= haired 2=both 3= conjunctiva - slides we look at in person` = col_factor(levels = c("1", 
            "2", "3")), `For stats, all locations for all cases, including slides we didn't see in person (1= haired 2=haired/junction 3= conjunctiva 4= unknown` = col_factor(levels = c("1", 
            "2", "3", "4")), `Female/Male` = col_factor(levels = c("F", 
            "M")), `Intact/altered` = col_factor(levels = c("I", 
            "A")), `nuclear atypia: >20%= 1, <20% =0` = col_factor(levels = c("0", 
            "1")), `mitotic count 3+ = 1, <3=0` = col_factor(levels = c("0", 
            "1")), `degree of pigmentation (<50%, low, moderate =1), >50%  or high = 0` = col_factor(levels = c("0", 
            "1")), `ulceration yes=1, no=0` = col_factor(levels = c("0", 
            "1")), `beyond dermis= 1, not beyond dermis =0` = col_factor(levels = c("0", 
            "1")), `>0.95 cm = 1, <0.95 cm = 0` = col_factor(levels = c("0", 
            "1")), `tumor thickness (cm)` = col_number(), 
        `Mitotic count (in 10 hpf)` = col_number()))
View(Melanoma_Project_For_STATS_final)

read_csv(here("Data/Raw/Melanoma Project For STATS final.csv"))

read_csv(here("Data/Raw/Melanoma Project For STATS final.csv"))

dat
```

# Statistical analysis

## Initial Data Analysis (IDA)

Basically, we would like to use the Ki67 index as our gold standard (column B).  Tumors that have a Ki67 index greater than 15%  (scored as a 1 in the table) are expected to have a worse prognosis. We would like to see how the other columns relate to Ki67.  For example, columns G-L are independent prognostic markers and we would expect that tumors scored as a 1 for those parameters would also most likely be scored a 1 for Ki67 index.  Also, tumors scored as a 0 for columns G-L would be more likely to have a score of 0 for Ki67 index (column B).   We do have actual measurements for mitotic count (column H) and tumor thickness (column L) that I can include if you think it would be useful to evaluate those parameters in that way as well.


Comparing sex (column E) and intact/altered status (column F) to Ki67 index is probably not as important but if you can see if there is any association, that would be great.

 

There are a few cases where we don’t have data for a particular parameter so those will have be censored.

 

For columns C and D, could you evaluate these independently?  We do not have as many data for column C as we do for D because we assessed this parameter in two different ways. For column B we determined the location ourselves by viewing the slides. For column D we estimated the location for the other cases based on interpretation of the report. 
